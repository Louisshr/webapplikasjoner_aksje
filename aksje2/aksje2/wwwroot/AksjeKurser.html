<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Aksjehandel</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="css/style.css">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>
    <section>
        <nav class="navbar justify-content-center navbar-expand navbar-dark bg-dark">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="Hovedside.html">Min side <span class="sr-only">(current)</span></a>
                </li>
                <li class="nav-item active">
                    <a class="nav-link" href="aksjekurser.html">Aksjer</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">Min Profil</a>
                </li>
            </ul>
        </nav>

        <!-- POP-UP BOKS-->
        <div class="modal fade" id="kjop_popupBox" tabindex="-1" role="dialog" aria-labelledby="popupBox" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="popupBox"></h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <table class="table-borderless">
                            <tbody>
                                <tr>
                                    <!-- Det som står i denne tabellcellen blir overskrift over input-boksen i pop-up boksen-->
                                    <td scope="col"></td>
                                </tr>
                                <tr>
                                    <td><input type="number" id="typeNumber" class="form-control" placeholder="antall aksjer"/></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Avbryt</button>
                        <button id="kjop-knapp" type="button" class="btn btn-primary">Kjøp</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- div med klasse: bestilling-conainer, skal fjernes-->

        <div class="bestilling-container">
            <p class="bestilling-navn">Akjsenavn</p>
            <p class="bestilling-kurs">Kurs</p>
            <input id="input-antall" type="text" />
            <button id="enKnapp">Kjøp</button>
            <p id="bestilling-feil"></p>
        </div>
    </section>
    <section>
        <div class="col">
            <div class="col fakeimg">Graf</div>
            <h4 class="m-3">Aksjer</h4>
            <div class="aksje-oversikt">
                <table class="table  table-sm">
                    <thead class="thead-light">
                        <tr>
                            <th scope="col">Navn</th>
                            <th style="width: 200px" scope="col">Siste</th>
                            <th style="width: 200px" scope="col">Kjøp</th>
                            <th style="width: 200px" scope="col">Selg</thstyle="width:>
                            <th style="width: 200px" scope="col">Kjøp </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <th scope="row">EQUINOR</th>
                            <td>378,10</td>
                            <td>378,10</td>
                            <td>375,23</td>
                            <td><button type="button" class="btn btn-success">Kjøp</button>
                        </tr>
                        <tr>
                            <th scope="row">DNB</th>
                            <td>378,10</td>
                            <td>378,10</td>
                            <td>375,23</td>
                            <td><button type="button" class="btn btn-success">Kjøp</button>
                        </tr>
                        <tr>
                            <th scope="row">TELENOR</th>
                            <td>378,10</td>
                            <td>378,10</td>
                            <td>375,23</td>
                            <td><button type="button" class="btn btn-success">Kjøp</button>
                        </tr>
                        

                    </tbody>
                </table>
            </div>
        </div>
    </section>

    <script>

        
        let personId = 1;
        $(function () {
            hentAlleAksjer();
        })

        function hentAlleAksjer() {
            $.get("aksje/hentAksjer", function (aksjer) {
                formaterAksjer(aksjer);
            })
        }

        

        function formaterAksjer(aksjer)
        {
            let ut = "<table class='table table-sm'>" + "<thead class='thead-light'>" + "<tr>" +
                "<th scope='col'>Navn</th>" +
                "<th style='width: 200px' scope='col'>Pris</th>" +
                "<th style='width: 200px' scope='col'>Omsetning</th>" +
                "<th style='width: 200px' scope='col'></th>" +
                
                "</thead>" +
                "<tbody>";

            
            for (let aksje of aksjer)
            {
                ut += "<tr>" +
                    "<th scope='row'>" + aksje.navn + "</th>" +
                    "<td>" + aksje.verdi + "</td>" +
                    "<td>" + aksje.omsetning + "</td>" +
                    "<td> <button type='button' class='btn btn-success' data-toggle='modal' data-target='#kjop_popupBox' onclick='kjop2(" + aksje.id + ")'>Kjøp</button></td>"
                    "</tr>";
            }
            
            ut += "</table>";

           document.querySelector(".aksje-oversikt").innerHTML = ut;
        }

        function kjop2(id)
        {
            const url = "aksje/hentEn?id=" + id;

            $.get(url, function (aksje) {
                //informasjon skal kun opprettes hvis get kallet er suksessfullt (skal være en if setning)
                //kan hende at bestilling navn og kurs bør defineres utenfor en funksjon slik at man ikke trenger å hente de hver gang

                document.getElementById("popupBox").innerHTML = "Kjøp " + "(" + aksje.navn + ")";
                document.getElementById("kjop-knapp").onclick = function () { fullforKjop(aksje.id, aksje.verdi, aksje.navn); }
               
            });

        }

        // denne funksjonen kan gjøres felles for både kjop og selg

        function kjop(id)
        {
            const url = "aksje/hentEn?id=" + id;

            $.get(url, function (aksje) {
                //informasjon skal kun opprettes hvis get kallet er suksessfullt
                //kan hende at bestilling navn og kurs bør defineres utenfor en funksjon slik at man ikke trenger å hente de hver gang
                

                document.querySelector(".bestilling-navn").innerHTML = aksje.navn;
                document.querySelector(".bestilling-kurs").innerHTML = aksje.verdi + " kr";
                document.getElementById("enKnapp").onclick = function () { fullforKjop(aksje.id, aksje.verdi, aksje.navn); }

                document.querySelector(".bestilling-container").style.display = "block";
                
            });
                        
        }

        // denne funksjonen brukes ikke. I den endelige versjonen av programmet skal ikke denne være der

        function utforKjop(verdi, antall, id, aksjeNavn) {

            let totalPris = verdi * antall;

            let salgObjekt =
            {
                person: personId,
                antall: antall,
                pris: totalPris,
                aksje: id
            }

            $.post("aksje/kjopAksje", salgObjekt, function (OK) {
                let ut = "";

                if (OK) {
                    ut = "Kjøp er gjennomført. Du handlet " + antall + " " + aksjeNavn + " aksjer. ";
                }
                else {
                    ut = "Det oppstod en feil under kjøpet. Kjøpet er avbrutt";
                }

                console.log(ut);

            })

        }

        function fullforKjop(id, verdi, aksje)
        {
            console.log("hei fra fullforkjop");
            /*
            let antall_input = document.getElementById("input-antall").value;
            let antall = Number(antall_input);

            // mulig å endre slik at det vises forskjellig feilmelding avhengig av om input er bokstaver eller om input feltet er tomt.

            if (isNaN(antall) || antall_input == '') {
                document.getElementById("bestilling-feil").innerHTML = "Venligst oppgi et gyldig antall";                
            }
            else
            {
                let total_pris = verdi * antall;

                let salgObjekt =
                {
                    person: personId,
                    antall: antall,
                    pris: total_pris,
                    aksje: id
                }
                $.post("aksje/kjopAksje", salgObjekt, function (OK) {
                    let ut = "";

                    if (OK) {
                        ut = "Kjøp er gjennomført. Du handlet " + antall + " " + aksje + " aksjer. ";
                    }
                    else {
                        ut = "Det oppstod en feil under kjøpet. Kjøpet er avbrutt";
                    }

                    console.log(ut);

                })
                
                
            }
            */
        }
    </script>
</body>
</html>
